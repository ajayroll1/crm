{% extends "dashboard/dashboard_base.html" %}
{% block title %}Settings - Sujata Associates{% endblock %}

{% block content %}
<div class="dashboard-header">
  <h1>Settings</h1>
  <p class="text-muted">Manage your organization, users, security, and app preferences</p>
</div>

<style>
  .settings-grid { display: grid; grid-template-columns: 280px 1fr; gap: 1.25rem; }
  .settings-nav .list-group-item { border: none; border-left: 3px solid transparent; padding: .75rem 1rem; }
  .settings-nav .list-group-item.active { background: #f1f5ff; color: #0d6efd; border-left-color: #0d6efd; }
  .settings-section .card { border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,.04); }
  .avatar { width: 56px; height: 56px; border-radius: 50%; object-fit: cover; }
  .form-help { font-size: .85rem; color: #6c757d; }
  .tile { padding: 1rem; border: 1px solid #e9ecef; border-radius: .75rem; display: flex; align-items: center; gap: .75rem; transition: .2s; }
  .tile:hover { background: #fafbff; border-color: #dbe4ff; }
  @media (max-width: 992px){ .settings-grid { grid-template-columns: 1fr; } }
  .badge-soft { background: #eef2ff; color: #3b5bdb; }
  .switch-desc { color: #6c757d; font-size: .9rem; }
  .integ-card { border: 1px dashed #dee2e6; border-radius: 10px; padding: 1rem; transition: .2s; }
  .integ-card:hover { background: #fcfcfe; border-color: #cfe2ff; }
  .section-title { font-weight: 600; color: #20304a; }
</style>

<div class="settings-grid">
  <!-- Left: Nav -->
  <div class="settings-nav">
    <div class="list-group" id="settingsTabs" role="tablist">
      <button class="list-group-item list-group-item-action active" data-bs-toggle="list" data-bs-target="#profile" role="tab"><i class="bi bi-person me-2"></i> Profile</button>
      <button class="list-group-item list-group-item-action" data-bs-toggle="list" data-bs-target="#organization" role="tab"><i class="bi bi-building me-2"></i> Organization</button>
      <button class="list-group-item list-group-item-action" data-bs-toggle="list" data-bs-target="#users" role="tab"><i class="bi bi-people me-2"></i> Users & Roles</button>
      <button class="list-group-item list-group-item-action" data-bs-toggle="list" data-bs-target="#security" role="tab"><i class="bi bi-shield-lock me-2"></i> Security</button>
      <button class="list-group-item list-group-item-action" data-bs-toggle="list" data-bs-target="#notifications" role="tab"><i class="bi bi-bell me-2"></i> Notifications</button>
      <button class="list-group-item list-group-item-action" data-bs-toggle="list" data-bs-target="#integrations" role="tab"><i class="bi bi-plug me-2"></i> Integrations</button>
      <button class="list-group-item list-group-item-action" data-bs-toggle="list" data-bs-target="#audit" role="tab"><i class="bi bi-activity me-2"></i> Audit Logs</button>
      <button class="list-group-item list-group-item-action" data-bs-toggle="list" data-bs-target="#preferences" role="tab"><i class="bi bi-sliders me-2"></i> Preferences</button>
    </div>
  </div>

  <!-- Right: Content -->
  <div class="tab-content settings-section">
    <!-- Profile -->
    <div class="tab-pane fade show active" id="profile" role="tabpanel">
      <div class="card mb-3">
        <div class="card-body">
          <div class="d-flex align-items-center gap-3">
            <img class="avatar" src="https://api.dicebear.com/7.x/initials/svg?seed={{ user_initials }}" alt="avatar">
            <div class="flex-grow-1">
              <h5 class="mb-1">{{ user_full_name }}</h5>
              <div class="text-muted">{{ user_email }}</div>
              {% if user_role %}
                <div class="mt-1">
                  <span class="badge bg-primary">{{ user_role }}</span>
                </div>
              {% endif %}
            </div>
            <button class="btn btn-outline-primary btn-sm">Change Avatar</button>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header bg-white"><span class="section-title">Basic Information</span></div>
        <div class="card-body">
          <form method="POST" action="{% url 'settings' %}">
            {% csrf_token %}
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Full Name</label>
                <input type="text" class="form-control" name="full_name" value="{{ user_full_name }}" placeholder="Enter full name">
              </div>
              <div class="col-md-6">
                <label class="form-label">Phone</label>
                <input type="text" class="form-control" name="phone" value="{{ user_phone }}" placeholder="+91 98765 43210">
              </div>
              <div class="col-md-6">
                <label class="form-label">Designation</label>
                <input type="text" class="form-control" name="designation" value="{{ user_designation }}" placeholder="e.g. HR Manager">
              </div>
              <div class="col-md-6">
                <label class="form-label">Time Zone</label>
                <select class="form-select" name="timezone">
                  <option value="Asia/Kolkata" selected>Asia/Kolkata (IST)</option>
                  <option value="UTC">UTC</option>
                  <option value="Asia/Dubai">Asia/Dubai (GST)</option>
                </select>
              </div>
            </div>
            <div class="mt-3 d-flex gap-2">
              <button type="submit" class="btn btn-primary">Save Changes</button>
              <button type="button" class="btn btn-light">Cancel</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Organization -->
    <div class="tab-pane fade" id="organization" role="tabpanel">
      <div class="row g-3">
        <div class="col-lg-6">
          <div class="card h-100">
            <div class="card-header bg-white"><span class="section-title">Company Profile</span></div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-12">
                  <label class="form-label">Company Name</label>
                  <input class="form-control" placeholder="Sujata Associates">
                </div>
                <div class="col-12">
                  <label class="form-label">Company Email</label>
                  <input class="form-control" placeholder="info@sujataassociates.com">
                </div>
                <div class="col-12">
                  <label class="form-label">Address</label>
                  <textarea class="form-control" rows="2" placeholder="Street, City, State, ZIP"></textarea>
                </div>
              </div>
              <div class="mt-3"><button class="btn btn-primary btn-sm">Update</button></div>
            </div>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="card h-100">
            <div class="card-header bg-white"><span class="section-title">Branding</span></div>
            <div class="card-body">
              <div class="d-flex align-items-center gap-3">
                <div class="tile">
                  <i class="bi bi-image fs-4 text-primary"></i>
                  <div>
                    <div class="fw-semibold">Logo</div>
                    <div class="form-help">PNG/SVG, max 1MB</div>
                  </div>
                </div>
                <button class="btn btn-outline-secondary btn-sm">Upload</button>
              </div>
              <div class="mt-3">
                <label class="form-label">Theme Color</label>
                <input type="color" class="form-control form-control-color" value="#1a1a2e">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Users & Roles -->
    <div class="tab-pane fade" id="users" role="tabpanel">
      <div class="card mb-3">
        <div class="card-body d-flex justify-content-between flex-wrap gap-2">
          <div>
            <div class="section-title">Team Members</div>
            <div class="text-muted">Invite, disable, and manage access</div>
          </div>
          <div class="d-flex gap-2">
            <input class="form-control form-control-sm" placeholder="Search user">
            <button class="btn btn-primary btn-sm"><i class="bi bi-person-plus"></i> Invite</button>
          </div>
        </div>
      </div>
      <div class="row g-3">
        <div class="col-md-6">
          <div class="tile">
            <i class="bi bi-shield-check text-success fs-4"></i>
            <div>
              <div class="fw-semibold">Admins</div>
              <div class="text-muted">Full access</div>
            </div>
            <span class="badge badge-soft ms-auto">3</span>
          </div>
        </div>
        <div class="col-md-6">
          <div class="tile">
            <i class="bi bi-person-workspace text-primary fs-4"></i>
            <div>
              <div class="fw-semibold">HR Managers</div>
              <div class="text-muted">Employees, leave, attendance</div>
            </div>
            <span class="badge badge-soft ms-auto">5</span>
          </div>
        </div>
        <div class="col-md-6">
          <div class="tile">
            <i class="bi bi-bar-chart text-warning fs-4"></i>
            <div>
              <div class="fw-semibold">Sales</div>
              <div class="text-muted">Leads and quotes</div>
            </div>
            <span class="badge badge-soft ms-auto">12</span>
          </div>
        </div>
        <div class="col-md-6">
          <div class="tile">
            <i class="bi bi-people text-secondary fs-4"></i>
            <div>
              <div class="fw-semibold">Employees</div>
              <div class="text-muted">Self-service access</div>
            </div>
            <span class="badge badge-soft ms-auto">120</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Security -->
    <div class="tab-pane fade" id="security" role="tabpanel">
      <div class="card">
        <div class="card-header bg-white"><span class="section-title">Authentication</span></div>
        <div class="card-body">
          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox" checked>
            <label class="form-check-label">Two-factor authentication</label>
            <div class="switch-desc">Require OTP on login for all admins</div>
          </div>
          <div class="form-check form-switch mb-3">
            <input class="form-check-input" type="checkbox">
            <label class="form-check-label">Session timeout</label>
            <div class="switch-desc">Auto logout after 30 minutes of inactivity</div>
          </div>
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Password policy</label>
              <select class="form-select">
                <option>Moderate (min 8 chars)</option>
                <option>Strict (min 12 chars, symbols)</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Allowed IPs (CIDR)</label>
              <input class="form-control" placeholder="e.g. 192.168.1.0/24">
            </div>
          </div>
          <div class="mt-3"><button class="btn btn-primary btn-sm">Save security settings</button></div>
        </div>
      </div>
    </div>

    <!-- Notifications -->
    <div class="tab-pane fade" id="notifications" role="tabpanel">
      <div class="row g-3">
        <div class="col-lg-6">
          <div class="card h-100">
            <div class="card-header bg-white"><span class="section-title">Email</span></div>
            <div class="card-body">
              <div class="form-check form-switch mb-2">
                <input class="form-check-input" type="checkbox" checked>
                <label class="form-check-label">Daily summary</label>
              </div>
              <div class="form-check form-switch mb-2">
                <input class="form-check-input" type="checkbox" checked>
                <label class="form-check-label">Leave requests</label>
              </div>
              <div class="form-check form-switch mb-2">
                <input class="form-check-input" type="checkbox">
                <label class="form-check-label">System alerts</label>
              </div>
            </div>
          </div>
        </div>
        <div class="col-lg-6">
          <div class="card h-100">
            <div class="card-header bg-white"><span class="section-title">In-app</span></div>
            <div class="card-body">
              <div class="form-check form-switch mb-2">
                <input class="form-check-input" type="checkbox" checked>
                <label class="form-check-label">Push notifications</label>
              </div>
              <div class="form-check form-switch mb-2">
                <input class="form-check-input" type="checkbox" checked>
                <label class="form-check-label">Announcements</label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Integrations -->
    <div class="tab-pane fade" id="integrations" role="tabpanel">
      <div class="row g-3">
        <div class="col-md-4">
          <div class="integ-card h-100 d-flex align-items-center gap-3">
            <i class="bi bi-google fs-3 text-danger"></i>
            <div class="flex-grow-1">
              <div class="fw-semibold">Google Calendar</div>
              <div class="text-muted">Sync events and leave</div>
            </div>
            <button class="btn btn-outline-primary btn-sm">Connect</button>
          </div>
        </div>
        <div class="col-md-4">
          <div class="integ-card h-100 d-flex align-items-center gap-3">
            <i class="bi bi-microsoft fs-3 text-primary"></i>
            <div class="flex-grow-1">
              <div class="fw-semibold">Microsoft 365</div>
              <div class="text-muted">Users and mails</div>
            </div>
            <button class="btn btn-outline-primary btn-sm">Connect</button>
          </div>
        </div>
        <div class="col-md-4">
          <div class="integ-card h-100 d-flex align-items-center gap-3">
            <i class="bi bi-slack fs-3 text-info"></i>
            <div class="flex-grow-1">
              <div class="fw-semibold">Slack</div>
              <div class="text-muted">Team notifications</div>
            </div>
            <button class="btn btn-outline-primary btn-sm">Connect</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Audit Logs -->
    <div class="tab-pane fade" id="audit" role="tabpanel">
      <div class="card">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
          <span class="section-title">Recent Activity</span>
          <input class="form-control form-control-sm" placeholder="Search logs">
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-sm align-middle">
              <thead>
                <tr><th>Time</th><th>User</th><th>Action</th><th>Details</th></tr>
              </thead>
              <tbody>
                <tr><td>10:05</td><td>Super Admin</td><td>Password Policy</td><td>Changed to Strict</td></tr>
                <tr><td>09:41</td><td>HR Manager</td><td>Invite</td><td>Invited user priyanka@company.com</td></tr>
                <tr><td>09:08</td><td>Super Admin</td><td>Branding</td><td>Updated logo</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Preferences -->
    <div class="tab-pane fade" id="preferences" role="tabpanel">
      <div class="card">
        <div class="card-header bg-white"><span class="section-title">General</span></div>
        <div class="card-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Default landing page</label>
              <select class="form-select">
                <option value="dashboard" selected>Dashboard</option>
                <option value="leads">Leads</option>
                <option value="attendance">Attendance</option>
                <option value="leave">Leave</option>
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label">Language</label>
              <select class="form-select">
                <option>English</option>
                <option>हिन्दी</option>
              </select>
            </div>
            <div class="col-12">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" id="darkModeSwitch">
                <label class="form-check-label" for="darkModeSwitch">Enable dark mode</label>
              </div>
            </div>
          </div>
          <div class="mt-3"><button class="btn btn-primary btn-sm">Save preferences</button></div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Keep active state in side list in sync when switching tabs
    const list = document.getElementById('settingsTabs');
    list?.addEventListener('shown.bs.tab', (e) => {
      const btn = e.target;
      list.querySelectorAll('.list-group-item').forEach(x => x.classList.remove('active'));
      btn.classList.add('active');
    });
  });
  // Optional: quick dark mode toggle (demo only)
  document.addEventListener('change', (e) => {
    const t = e.target;
    if (t && t.id === 'darkModeSwitch') {
      document.body.classList.toggle('bg-dark');
      document.querySelectorAll('.card').forEach(c => c.classList.toggle('text-white'));
    }
  });
  </script>
{% endblock %}


