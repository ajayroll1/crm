{% extends "employee/base.html" %}
{% load static %}

{% block title %}Accounts Team Workspace - Sujata Associates{% endblock %}
{% block page_title %}Accounts Team Workspace{% endblock %}
{% block mobile_title %}Accounts{% endblock %}

{% block extra_css %}
<style>
  .accounts-wrapper {
    width: 100%;
    overflow-x: hidden;
    box-sizing: border-box;
  }

  .accounts-table {
    width: 100%;
    border-collapse: collapse;
  }

  .accounts-table th,
  .accounts-table td {
    white-space: normal;
    vertical-align: middle;
    word-break: break-word;
  }

  .reference-table th,
  .reference-table td {
    white-space: normal;
    word-break: normal;
  }

  .accounts-table .actions-column {
    white-space: nowrap;
  }

  .table-section .table-wrapper {
    width: 100%;
  }

  .action-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 34px;
    height: 34px;
    border-radius: 50%;
    border: 1px solid rgba(148, 163, 184, 0.6);
    background: #ffffff;
    color: #1a202c;
    margin-left: 0.35rem;
    transition: all 0.2s ease;
    text-decoration: none;
  }

  .action-icon:first-child {
    margin-left: 0;
  }

  .action-icon.edit {
    color: #1f4aa1;
    border-color: rgba(31, 74, 161, 0.35);
  }

  .action-icon.delete {
    color: #dc2626;
    border-color: rgba(220, 38, 38, 0.35);
  }

  .action-icon:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
  }

  .action-icon.edit:hover {
    background: rgba(31, 74, 161, 0.08);
  }

  .action-icon.delete:hover {
    background: rgba(220, 38, 38, 0.08);
  }

  .main-content > .accounts-wrapper {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }

  .accounts-tabs .nav-link {
    border-radius: 10px;
    font-weight: 600;
    color: #4a5568;
    border: 1px solid transparent;
    transition: all 0.25s ease;
  }

  .accounts-tabs .nav-link i {
    font-size: 1.1rem;
  }

  .accounts-tabs .nav-link.active,
  .accounts-tabs .nav-link:hover {
    background: linear-gradient(90deg, rgba(52, 152, 219, 0.15), rgba(46, 204, 113, 0.15));
    color: #1a202c;
    border-color: rgba(52, 152, 219, 0.35);
  }

  .compliance-badge {
    font-size: 0.75rem;
    padding: 0.2rem 0.6rem;
    border-radius: 50px;
    font-weight: 600;
    letter-spacing: 0.3px;
  }

  .checklist-item {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.75rem 0;
    border-bottom: 1px dashed #e2e8f0;
  }

  .checklist-item:last-child {
    border-bottom: none;
  }

  .upload-dropzone {
    border: 2px dashed #cbd5f5;
    border-radius: 12px;
    background: rgba(79, 70, 229, 0.05);
    padding: 1rem;
    text-align: center;
    transition: all 0.25s ease;
  }

  .upload-dropzone:hover {
    background: rgba(79, 70, 229, 0.1);
    border-color: rgba(79, 70, 229, 0.5);
  }

  .section-divider {
    margin: 2rem 0 1.5rem;
    border-top: 1px dashed #dfe3eb;
  }

  .calendar-item {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
    padding: 0.85rem 0;
    border-bottom: 1px solid #edf2f7;
  }

  .calendar-item:last-child {
    border-bottom: none;
  }

  .accounts-section-card .card-header {
    background: linear-gradient(135deg, #1f4aa1, #2fb7ff) !important;
    color: #ffffff;
    border: none;
    border-radius: 12px 12px 0 0;
  }

  .accounts-section-card .card-header h6,
  .accounts-section-card .card-header span,
  .accounts-section-card .card-header .badge {
    color: #ffffff !important;
  }

  .accounts-section-card .card-header .badge {
    background: rgba(255, 255, 255, 0.2);
  }

  .accounts-header-badge {
    background: rgba(255, 255, 255, 0.18);
    border: 1px solid rgba(255, 255, 255, 0.35);
  }

  .btn-white {
    background: #ffffff;
    color: #1a202c;
    border: 1px solid rgba(26, 32, 44, 0.1);
    transition: all 0.2s ease;
  }

  .btn-white:hover {
    background: #f7fafc;
    color: #0f172a;
    border-color: rgba(26, 32, 44, 0.25);
  }

  @media (max-width: 768px) {
    .accounts-tabs {
      overflow-x: visible;
      flex-wrap: wrap;
      gap: 0.75rem;
    }

    .accounts-tabs .nav-link {
      white-space: normal;
      width: 100%;
      text-align: left;
      font-size: 0.95rem;
      padding: 0.65rem 1rem;
    }

    .metric-card {
      padding: 1.1rem;
      margin-bottom: 0.75rem;
    }

    .upload-dropzone {
      padding: 0.85rem;
    }

    .calendar-item {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.35rem;
    }

    .calendar-item .compliance-badge {
      align-self: flex-start;
    }

    .card-body {
      padding: 1rem;
    }

    .card-header {
      padding: 1rem;
    }

    .tab-content .row.g-4 > [class*="col"] {
      margin-bottom: 1rem;
    }

    .accounts-wrapper {
      padding: 0 0.75rem !important;
    }

    .accounts-table th,
    .accounts-table td {
      font-size: 0.875rem;
    }

    .reference-table th,
    .reference-table td {
      font-size: 0.875rem;
    }

    .action-icon {
      width: 30px;
      height: 30px;
    }
  }

  @media (max-width: 576px) {
    .accounts-tabs .nav-link {
      font-size: 0.9rem;
      padding: 0.6rem 0.85rem;
    }

    .metric-card {
      padding: 1rem;
    }

    .upload-dropzone {
      padding: 0.75rem;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-0 accounts-wrapper">
  <div class="row g-3 mb-3">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3">
            <div>
              <h5 class="mb-1 text-primary">Account Management Control Center</h5>
              <p class="mb-0 text-muted">Track statutory filings, collect documents, and collaborate across ROC, GST, ITR, bookkeeping, and TDS workflows.</p>
            </div>
            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-primary">
                <i class="bi bi-calendar-check me-2"></i>Compliance Calendar
              </button>
              <button class="btn btn-outline-secondary">
                <i class="bi bi-shield-lock me-2"></i>View SOP Library
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3 mb-4">
    <div class="col-sm-6 col-xl-3">
      <div class="metric-card h-100">
        <div class="d-flex align-items-center">
          <div class="metric-icon primary">
            <i class="bi bi-building-check"></i>
          </div>
          <div>
            <div class="metric-title">ROC Filings</div>
                <div class="metric-value">{{ roc_count|default:"0" }}</div>
            <div class="metric-subtitle">Upcoming due dates</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-xl-3">
      <div class="metric-card h-100">
        <div class="d-flex align-items-center">
          <div class="metric-icon info">
            <i class="bi bi-file-earmark-spreadsheet"></i>
          </div>
          <div>
            <div class="metric-title">GST Returns</div>
                <div class="metric-value">{{ gst_count|default:"0" }}</div>
            <div class="metric-subtitle">Pending submissions</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-xl-3">
      <div class="metric-card h-100">
        <div class="d-flex align-items-center">
          <div class="metric-icon success">
            <i class="bi bi-cash-coin"></i>
          </div>
          <div>
            <div class="metric-title">ITR Filings</div>
                <div class="metric-value">{{ itr_count|default:"0" }}</div>
            <div class="metric-subtitle">FY in progress</div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-6 col-xl-3">
      <div class="metric-card h-100">
        <div class="d-flex align-items-center">
          <div class="metric-icon warning">
            <i class="bi bi-receipt-cutoff"></i>
          </div>
          <div>
            <div class="metric-title">TDS & Withholding</div>
                <div class="metric-value">{{ tds_count|default:"0" }}</div>
            <div class="metric-subtitle">Current month deductions</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <ul class="nav nav-pills accounts-tabs gap-2 mb-4" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="roc-tab" data-bs-toggle="tab" data-bs-target="#roc-pane" type="button" role="tab">
                <i class="bi bi-building"></i> ROC Compliance
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="gst-tab" data-bs-toggle="tab" data-bs-target="#gst-pane" type="button" role="tab">
                <i class="bi bi-receipt"></i> GST Filing
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="itr-tab" data-bs-toggle="tab" data-bs-target="#itr-pane" type="button" role="tab">
                <i class="bi bi-cash-stack"></i> ITR Filing
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="bookkeeping-tab" data-bs-toggle="tab" data-bs-target="#bookkeeping-pane" type="button" role="tab">
                <i class="bi bi-journal-bookmark"></i> Accounts & Bookkeeping
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="tds-tab" data-bs-toggle="tab" data-bs-target="#tds-pane" type="button" role="tab">
                <i class="bi bi-percent"></i> TDS Compliance
              </button>
            </li>
          </ul>

          <div class="tab-content">
            <!-- ROC Tab -->
            <div class="tab-pane fade show active" id="roc-pane" role="tabpanel" aria-labelledby="roc-tab">
              <div class="row g-4">
                <div class="col-lg-8">
      <div class="card border-0 shadow-sm accounts-section-card">
                    <div class="card-header bg-transparent">
                      <h6 class="mb-0 text-primary">Annual ROC Return Preparation</h6>
                    </div>
                    <div class="card-body">
                      <form method="post" enctype="multipart/form-data" class="row g-3">
                        {% csrf_token %}
                        <input type="hidden" name="form_name" value="roc">
                        {% if roc_form.non_field_errors %}
                        <div class="col-12">
                          <div class="alert alert-danger mb-0">
                            {{ roc_form.non_field_errors }}
                          </div>
                        </div>
                        {% endif %}
                        <div class="col-md-6">
                          <label class="form-label">Company Name</label>
                          {{ roc_form.company_name }}
                          {% if roc_form.company_name.errors %}
                          <div class="text-danger small">{{ roc_form.company_name.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">CIN / LLPIN</label>
                          {{ roc_form.cin_llpin }}
                          {% if roc_form.cin_llpin.errors %}
                          <div class="text-danger small">{{ roc_form.cin_llpin.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Financial Year</label>
                          {{ roc_form.financial_year }}
                          {% if roc_form.financial_year.errors %}
                          <div class="text-danger small">{{ roc_form.financial_year.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">AGM Date</label>
                          {{ roc_form.agm_date }}
                          {% if roc_form.agm_date.errors %}
                          <div class="text-danger small">{{ roc_form.agm_date.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Compliance Period</label>
                          {{ roc_form.compliance_period }}
                          {% if roc_form.compliance_period.errors %}
                          <div class="text-danger small">{{ roc_form.compliance_period.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Digital Signature</label>
                          {{ roc_form.digital_signature }}
                          {% if roc_form.digital_signature.errors %}
                          <div class="text-danger small">{{ roc_form.digital_signature.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-12">
                          <label class="form-label">Pending Queries / Notes</label>
                          {{ roc_form.pending_queries }}
                          {% if roc_form.pending_queries.errors %}
                          <div class="text-danger small">{{ roc_form.pending_queries.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-12">
                          <label class="form-label">Upload Supporting Documents</label>
                          <div class="upload-dropzone">
                            <i class="bi bi-cloud-arrow-up fs-3 text-primary"></i>
                            <p class="mb-1 fw-semibold">Drop ROC documents or click to browse</p>
                            <p class="text-muted small mb-2">Board report, financial statements, Auditor report, attendance registers</p>
                            <input type="file" class="form-control" name="roc_documents" multiple>
                          </div>
                        </div>
                        <div class="col-12 d-flex justify-content-end gap-2">
                          <button type="submit" name="action" value="save" class="btn btn-outline-secondary">Save Draft</button>
                          <button type="submit" name="action" value="ready" class="btn btn-primary">Mark Ready for Filing</button>
                        </div>
                      </form>
                      <div class="section-divider"></div>
                      <h6 class="text-muted text-uppercase small mb-3">Saved Records</h6>
                      {% if roc_records %}
                      <div class="table-wrapper table-section">
                        <table class="table table-hover align-middle mb-0 accounts-table">
                          <thead>
                            <tr>
                              <th>Company</th>
                              <th>Financial Year</th>
                              <th>Compliance Period</th>
                              <th>AGM Date</th>
                              <th>Created</th>
                              <th class="text-end">Actions</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for record in roc_records %}
                            <tr>
                              <td class="fw-semibold">{{ record.company_name }}</td>
                              <td>{{ record.financial_year }}</td>
                              <td>{{ record.compliance_period }}</td>
                              <td>{{ record.agm_date|date:"d M Y"|default:"—" }}</td>
                              <td class="text-muted small">{{ record.created_at|date:"d M Y" }}</td>
                              <td class="actions-column text-end">
                                <a href="{% url 'employee_accounts_edit' 'roc' record.id %}" class="action-icon edit" title="Edit">
                                  <i class="bi bi-pencil-square"></i>
                                </a>
                                <form method="post" action="{% url 'employee_accounts_delete' 'roc' record.id %}" class="d-inline">
                                  {% csrf_token %}
                                  <button type="submit" class="action-icon delete" title="Delete" onclick="return confirm('Delete this ROC record?');">
                                    <i class="bi bi-trash"></i>
                                  </button>
                                </form>
                              </td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                      {% else %}
                      <p class="text-muted small mb-0">No ROC compliance records saved yet.</p>
                      {% endif %}
                    </div>
                  </div>
                </div>
                <div class="col-lg-4">
                  <div class="card border-0 shadow-sm mb-3 accounts-section-card">
                    <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
                      <h6 class="mb-0 text-primary">ROC Document Checklist</h6>
                      <span class="badge accounts-header-badge compliance-badge">Reference</span>
                    </div>
                    <div class="card-body">
                      {% for doc in roc_required_docs %}
                      <div class="checklist-item">
                        <i class="bi bi-check2-circle text-success fs-5"></i>
                        <div>
                          <h6 class="mb-1">{{ doc.name }}</h6>
                          <p class="mb-1 text-muted small">{{ doc.description }}</p>
                          <span class="badge rounded-pill bg-light text-primary fw-semibold">Due: {{ doc.due }}</span>
                        </div>
                      </div>
                      {% empty %}
                      <p class="text-muted">No checklist items configured.</p>
                      {% endfor %}
                    </div>
                  </div>

                  <div class="card border-0 shadow-sm accounts-section-card">
                    <div class="card-header bg-transparent">
                      <h6 class="mb-0 text-primary">Key Statutory Notes</h6>
                    </div>
                    <div class="card-body">
                      <ul class="list-unstyled mb-0 small text-muted">
                        <li class="mb-2"><i class="bi bi-dot text-primary fs-4 align-middle"></i> Ensure financial statements are signed by directors and auditors before upload.</li>
                        <li class="mb-2"><i class="bi bi-dot text-primary fs-4 align-middle"></i> Verify secretarial compliance certificate for companies crossing ₹10 crore paid-up capital.</li>
                        <li class="mb-2"><i class="bi bi-dot text-primary fs-4 align-middle"></i> Maintain proof of AGM notice circulation and attendance register.</li>
                        <li><i class="bi bi-dot text-primary fs-4 align-middle"></i> Keep digital signature tokens updated and stored in compliance locker.</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- GST Tab -->
            <div class="tab-pane fade" id="gst-pane" role="tabpanel" aria-labelledby="gst-tab">
              <div class="row g-4">
                <div class="col-xl-7">
                  <div class="card border-0 shadow-sm accounts-section-card">
                    <div class="card-header bg-transparent">
                      <h6 class="mb-0 text-primary">GST Return Builder</h6>
                    </div>
                    <div class="card-body">
                      <form method="post" enctype="multipart/form-data" class="row g-3">
                        {% csrf_token %}
                        <input type="hidden" name="form_name" value="gst">
                        {% if gst_form.non_field_errors %}
                        <div class="col-12">
                          <div class="alert alert-danger mb-0">
                            {{ gst_form.non_field_errors }}
                          </div>
                        </div>
                        {% endif %}
                        <div class="col-md-6">
                          <label class="form-label">GSTIN</label>
                          {{ gst_form.gstin }}
                          {% if gst_form.gstin.errors %}
                          <div class="text-danger small">{{ gst_form.gstin.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Return Period</label>
                          {{ gst_form.return_period }}
                          {% if gst_form.return_period.errors %}
                          <div class="text-danger small">{{ gst_form.return_period.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Return Type</label>
                          {{ gst_form.return_type }}
                          {% if gst_form.return_type.errors %}
                          <div class="text-danger small">{{ gst_form.return_type.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Filing Scheme</label>
                          {{ gst_form.filing_scheme }}
                          {% if gst_form.filing_scheme.errors %}
                          <div class="text-danger small">{{ gst_form.filing_scheme.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-12">
                          <label class="form-label">Upload Data Files</label>
                          <div class="row g-3">
                            <div class="col-md-6">
                              <div class="upload-dropzone">
                                <i class="bi bi-upload text-primary fs-4"></i>
                                <p class="mb-1 fw-semibold">Outward Supplies (B2B/B2C)</p>
                                <input type="file" class="form-control mt-2" name="gst_outward_supplies" multiple>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="upload-dropzone">
                                <i class="bi bi-upload text-primary fs-4"></i>
                                <p class="mb-1 fw-semibold">Input Tax Credit Register</p>
                                <input type="file" class="form-control mt-2" name="gst_input_tax_credit" multiple>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="upload-dropzone">
                                <i class="bi bi-upload text-primary fs-4"></i>
                                <p class="mb-1 fw-semibold">Reverse Charge (RCM)</p>
                                <input type="file" class="form-control mt-2" name="gst_reverse_charge" multiple>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <div class="upload-dropzone">
                                <i class="bi bi-upload text-primary fs-4"></i>
                                <p class="mb-1 fw-semibold">E-way Bill Summary</p>
                                <input type="file" class="form-control mt-2" name="gst_eway_bill" multiple>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Tax Payable (₹)</label>
                          {{ gst_form.tax_payable }}
                          {% if gst_form.tax_payable.errors %}
                          <div class="text-danger small">{{ gst_form.tax_payable.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Input Credit Utilized (₹)</label>
                          {{ gst_form.input_credit_utilized }}
                          {% if gst_form.input_credit_utilized.errors %}
                          <div class="text-danger small">{{ gst_form.input_credit_utilized.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-12">
                          <label class="form-label">Internal Remarks</label>
                          {{ gst_form.internal_remarks }}
                          {% if gst_form.internal_remarks.errors %}
                          <div class="text-danger small">{{ gst_form.internal_remarks.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-12 d-flex justify-content-end gap-2">
                          <button type="submit" name="action" value="save" class="btn btn-outline-secondary">Save Checklist</button>
                          <button type="submit" name="action" value="generate" class="btn btn-primary">Generate Filing Pack</button>
                        </div>
                      </form>
                      <div class="section-divider"></div>
                      <h6 class="text-muted text-uppercase small mb-3">Saved Records</h6>
                      {% if gst_records %}
                      <div class="table-wrapper table-section">
                        <table class="table table-hover align-middle mb-0 accounts-table">
                          <thead>
                            <tr>
                              <th>GSTIN</th>
                              <th>Return Period</th>
                              <th>Return Type</th>
                              <th>Tax Payable (₹)</th>
                              <th>Credit Utilized (₹)</th>
                              <th>Created</th>
                              <th class="text-end">Actions</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for record in gst_records %}
                            <tr>
                              <td class="fw-semibold">{{ record.gstin }}</td>
                              <td>{{ record.return_period }}</td>
                              <td>{{ record.return_type }}</td>
                              <td>{{ record.tax_payable|floatformat:2 }}</td>
                              <td>{{ record.input_credit_utilized|floatformat:2 }}</td>
                              <td class="text-muted small">{{ record.created_at|date:"d M Y" }}</td>
                              <td class="actions-column text-end">
                                <a href="{% url 'employee_accounts_edit' 'gst' record.id %}" class="action-icon edit" title="Edit">
                                  <i class="bi bi-pencil-square"></i>
                                </a>
                                <form method="post" action="{% url 'employee_accounts_delete' 'gst' record.id %}" class="d-inline">
                                  {% csrf_token %}
                                  <button type="submit" class="action-icon delete" title="Delete" onclick="return confirm('Delete this GST record?');">
                                    <i class="bi bi-trash"></i>
                                  </button>
                                </form>
                              </td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                      {% else %}
                      <p class="text-muted small mb-0">No GST filing records saved yet.</p>
                      {% endif %}
                    </div>
                  </div>
                </div>

                <div class="col-xl-5">
                  <div class="card border-0 shadow-sm mb-3 accounts-section-card">
                    <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
                      <h6 class="mb-0 text-primary">GST Returns at a Glance</h6>
                      <span class="badge accounts-header-badge fw-semibold">Reference</span>
                    </div>
                    <div class="table-wrapper table-section">
                      <table class="table mb-0 align-middle reference-table">
                        <thead>
                          <tr>
                            <th>Return</th>
                            <th>Frequency</th>
                            <th>Purpose</th>
                            <th>Due Date</th>
                          </tr>
                        </thead>
                        <tbody>
                          {% for gst_return in gst_return_types %}
                          <tr>
                            <td class="fw-semibold">{{ gst_return.code }}</td>
                            <td>{{ gst_return.frequency }}</td>
                            <td class="text-muted small">{{ gst_return.purpose }}</td>
                            <td>
                              {% if gst_return.next_due_dates %}
                                {% for due in gst_return.next_due_dates %}
                                <span class="badge bg-primary text-white me-1 mb-1">{{ due }}</span>
                                {% endfor %}
                               {% else %}
                               <span class="badge bg-primary text-white">{{ gst_return.due_date }}</span>
                               {% endif %}
                             </td>
                          </tr>
                          {% empty %}
                          <tr>
                            <td colspan="4" class="text-center text-muted">No GST return templates configured.</td>
                          </tr>
                          {% endfor %}
                        </tbody>
                      </table>
                    </div>
                  </div>

                  <div class="card border-0 shadow-sm accounts-section-card">
                    <div class="card-header bg-transparent">
                      <h6 class="mb-0 text-primary">Data Pack Checklist</h6>
                    </div>
                    <div class="card-body">
                      <ul class="list-unstyled mb-0 small text-muted">
                        {% for item in gst_upload_requirements %}
                        <li class="mb-2"><i class="bi bi-dot text-primary fs-4 align-middle"></i>{{ item }}</li>
                        {% empty %}
                        <li class="text-muted">No checklist items configured.</li>
                        {% endfor %}
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- ITR Tab -->
            <div class="tab-pane fade" id="itr-pane" role="tabpanel" aria-labelledby="itr-tab">
              <div class="row g-4">
                <div class="col-lg-7">
                  <div class="card border-0 shadow-sm accounts-section-card">
                    <div class="card-header bg-transparent">
                      <h6 class="mb-0 text-primary">Income Tax Return Intake Form</h6>
                    </div>
                    <div class="card-body">
                      <form method="post" enctype="multipart/form-data" class="row g-3">
                        {% csrf_token %}
                        <input type="hidden" name="form_name" value="itr">
                        {% if itr_form.non_field_errors %}
                        <div class="col-12">
                          <div class="alert alert-danger mb-0">
                            {{ itr_form.non_field_errors }}
                          </div>
                        </div>
                        {% endif %}
                        <div class="col-md-6">
                          <label class="form-label">Taxpayer Name</label>
                          {{ itr_form.taxpayer_name }}
                          {% if itr_form.taxpayer_name.errors %}
                          <div class="text-danger small">{{ itr_form.taxpayer_name.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">PAN</label>
                          {{ itr_form.pan }}
                          {% if itr_form.pan.errors %}
                          <div class="text-danger small">{{ itr_form.pan.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Assessment Year</label>
                          {{ itr_form.assessment_year }}
                          {% if itr_form.assessment_year.errors %}
                          <div class="text-danger small">{{ itr_form.assessment_year.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Return Form</label>
                          {{ itr_form.return_form }}
                          {% if itr_form.return_form.errors %}
                          <div class="text-danger small">{{ itr_form.return_form.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Client Category</label>
                          {{ itr_form.client_category }}
                          {% if itr_form.client_category.errors %}
                          <div class="text-danger small">{{ itr_form.client_category.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Books of Account</label>
                          {{ itr_form.books_of_account }}
                          {% if itr_form.books_of_account.errors %}
                          <div class="text-danger small">{{ itr_form.books_of_account.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-12">
                          <label class="form-label">Upload Financial Documents</label>
                          <div class="upload-dropzone">
                            <i class="bi bi-cloud-arrow-up fs-3 text-primary"></i>
                            <p class="mb-1 fw-semibold">Attach Form 16, AIS, bank statements, investment proofs</p>
                            <input type="file" class="form-control" name="itr_documents" multiple>
                          </div>
                        </div>
                        <div class="col-12">
                          <label class="form-label">Computation Notes</label>
                          {{ itr_form.computation_notes }}
                          {% if itr_form.computation_notes.errors %}
                          <div class="text-danger small">{{ itr_form.computation_notes.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-12 d-flex justify-content-end gap-2">
                          <button type="submit" name="action" value="save" class="btn btn-outline-secondary">Save Intake</button>
                          <button type="submit" name="action" value="review" class="btn btn-primary">Send for Review</button>
                        </div>
                      </form>
                      <div class="section-divider"></div>
                      <h6 class="text-muted text-uppercase small mb-3">Saved Records</h6>
                      {% if itr_records %}
                      <div class="table-wrapper table-section">
                        <table class="table table-hover align-middle mb-0 accounts-table">
                          <thead>
                            <tr>
                              <th>Taxpayer</th>
                              <th>PAN</th>
                              <th>Assessment Year</th>
                              <th>Return Form</th>
                              <th>Client Category</th>
                              <th>Created</th>
                              <th class="text-end">Actions</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for record in itr_records %}
                            <tr>
                              <td class="fw-semibold">{{ record.taxpayer_name }}</td>
                              <td>{{ record.pan }}</td>
                              <td>{{ record.assessment_year }}</td>
                              <td>{{ record.return_form }}</td>
                              <td>{{ record.client_category }}</td>
                              <td class="text-muted small">{{ record.created_at|date:"d M Y" }}</td>
                              <td class="actions-column text-end">
                                <a href="{% url 'employee_accounts_edit' 'itr' record.id %}" class="action-icon edit" title="Edit">
                                  <i class="bi bi-pencil-square"></i>
                                </a>
                                <form method="post" action="{% url 'employee_accounts_delete' 'itr' record.id %}" class="d-inline">
                                  {% csrf_token %}
                                  <button type="submit" class="action-icon delete" title="Delete" onclick="return confirm('Delete this ITR record?');">
                                    <i class="bi bi-trash"></i>
                                  </button>
                                </form>
                              </td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                      {% else %}
                      <p class="text-muted small mb-0">No ITR filing records saved yet.</p>
                      {% endif %}
                    </div>
                  </div>
                </div>

                <div class="col-lg-5">
                  <div class="card border-0 shadow-sm mb-3 accounts-section-card">
                    <div class="card-header bg-transparent">
                      <h6 class="mb-0 text-primary">ITR Form Selection Matrix</h6>
                    </div>
                    <div class="card-body">
                      {% for profile in itr_profiles %}
                      <div class="checklist-item">
                        <i class="bi bi-file-earmark-text text-success fs-5"></i>
                        <div>
                          <h6 class="mb-1">{{ profile.form }}</h6>
                          <p class="mb-1 text-muted small">{{ profile.applicable_for }}</p>
                          <span class="badge bg-light text-primary fw-semibold">Docs: {{ profile.documents }}</span>
                        </div>
                      </div>
                      {% empty %}
                      <p class="text-muted">No ITR guidance configured.</p>
                      {% endfor %}
                    </div>
                  </div>

                  <div class="card border-0 shadow-sm accounts-section-card">
                    <div class="card-header bg-transparent">
                      <h6 class="mb-0 text-primary">Review Checklist</h6>
                    </div>
                    <div class="card-body">
                      <ul class="list-unstyled mb-0 small text-muted">
                        <li class="mb-2"><i class="bi bi-dot text-primary fs-4 align-middle"></i>Match income reported in AIS/TIS with computation.</li>
                        <li class="mb-2"><i class="bi bi-dot text-primary fs-4 align-middle"></i>Verify advance tax and TDS credit in Form 26AS.</li>
                        <li class="mb-2"><i class="bi bi-dot text-primary fs-4 align-middle"></i>Confirm relief claims under Section 89, 87A, and foreign tax credit.</li>
                        <li><i class="bi bi-dot text-primary fs-4 align-middle"></i>Document final acknowledgement number after filing.</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Accounts & Bookkeeping Tab -->
            <div class="tab-pane fade" id="bookkeeping-pane" role="tabpanel" aria-labelledby="bookkeeping-tab">
              <div class="row g-4">
                <div class="col-lg-8">
                  <div class="card border-0 shadow-sm accounts-section-card">
                    <div class="card-header bg-transparent">
                      <h6 class="mb-0 text-primary">Daily Closing Checklist</h6>
                    </div>
                    <div class="card-body">
                      <form method="post" enctype="multipart/form-data" class="row g-3">
                        {% csrf_token %}
                        <input type="hidden" name="form_name" value="bookkeeping">
                        {% if bookkeeping_form.non_field_errors %}
                        <div class="col-12">
                          <div class="alert alert-danger mb-0">
                            {{ bookkeeping_form.non_field_errors }}
                          </div>
                        </div>
                        {% endif %}
                        <div class="col-md-6">
                          <label class="form-label">Closing Date</label>
                          {{ bookkeeping_form.closing_date }}
                          {% if bookkeeping_form.closing_date.errors %}
                          <div class="text-danger small">{{ bookkeeping_form.closing_date.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Prepared By</label>
                          {{ bookkeeping_form.prepared_by }}
                          {% if bookkeeping_form.prepared_by.errors %}
                          <div class="text-danger small">{{ bookkeeping_form.prepared_by.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            {{ bookkeeping_form.cash_book_updated }}
                            <label class="form-check-label" for="{{ bookkeeping_form.cash_book_updated.id_for_label }}">Cash book updated</label>
                          </div>
                          {% if bookkeeping_form.cash_book_updated.errors %}
                          <div class="text-danger small">{{ bookkeeping_form.cash_book_updated.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            {{ bookkeeping_form.bank_entries_reconciled }}
                            <label class="form-check-label" for="{{ bookkeeping_form.bank_entries_reconciled.id_for_label }}">Bank entries reconciled</label>
                          </div>
                          {% if bookkeeping_form.bank_entries_reconciled.errors %}
                          <div class="text-danger small">{{ bookkeeping_form.bank_entries_reconciled.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-4">
                          <div class="form-check">
                            {{ bookkeeping_form.inventory_updated }}
                            <label class="form-check-label" for="{{ bookkeeping_form.inventory_updated.id_for_label }}">Inventory updated</label>
                          </div>
                          {% if bookkeeping_form.inventory_updated.errors %}
                          <div class="text-danger small">{{ bookkeeping_form.inventory_updated.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-12">
                          <label class="form-label">Outstanding Task Notes</label>
                          {{ bookkeeping_form.outstanding_notes }}
                          {% if bookkeeping_form.outstanding_notes.errors %}
                          <div class="text-danger small">{{ bookkeeping_form.outstanding_notes.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-12">
                          <label class="form-label">Upload Reconciliation Files</label>
                          <div class="upload-dropzone">
                            <i class="bi bi-cloud-arrow-up fs-3 text-primary"></i>
                            <p class="mb-1 fw-semibold">Drop bank reconciliation statements, AR/AP ageing, inventory valuation reports</p>
                            <input type="file" class="form-control" name="bookkeeping_documents" multiple>
                          </div>
                        </div>
                        <div class="col-12 d-flex justify-content-end gap-2">
                          <button type="submit" name="action" value="save" class="btn btn-outline-secondary">Save Log</button>
                          <button type="submit" name="action" value="complete" class="btn btn-primary">Complete Day Close</button>
                        </div>
                      </form>
                      <div class="section-divider"></div>
                      <h6 class="text-muted text-uppercase small mb-3">Saved Records</h6>
                      {% if bookkeeping_records %}
                      <div class="table-wrapper table-section">
                        <table class="table table-hover align-middle mb-0 accounts-table">
                          <thead>
                            <tr>
                              <th>Closing Date</th>
                              <th>Prepared By</th>
                              <th>Cash Book</th>
                              <th>Bank Reconciled</th>
                              <th>Inventory</th>
                              <th>Created</th>
                              <th class="text-end">Actions</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for record in bookkeeping_records %}
                            <tr>
                              <td>{{ record.closing_date|date:"d M Y"|default:"—" }}</td>
                              <td class="fw-semibold">{{ record.prepared_by }}</td>
                              <td>
                                {% if record.cash_book_updated %}
                                <span class="badge bg-success-subtle text-success"><i class="bi bi-check-lg"></i></span>
                                {% else %}
                                <span class="badge bg-secondary-subtle text-secondary"><i class="bi bi-dash-lg"></i></span>
                                {% endif %}
                              </td>
                              <td>
                                {% if record.bank_entries_reconciled %}
                                <span class="badge bg-success-subtle text-success"><i class="bi bi-check-lg"></i></span>
                                {% else %}
                                <span class="badge bg-secondary-subtle text-secondary"><i class="bi bi-dash-lg"></i></span>
                                {% endif %}
                              </td>
                              <td>
                                {% if record.inventory_updated %}
                                <span class="badge bg-success-subtle text-success"><i class="bi bi-check-lg"></i></span>
                                {% else %}
                                <span class="badge bg-secondary-subtle text-secondary"><i class="bi bi-dash-lg"></i></span>
                                {% endif %}
                              </td>
                              <td class="text-muted small">{{ record.created_at|date:"d M Y" }}</td>
                              <td class="actions-column text-end">
                                <a href="{% url 'employee_accounts_edit' 'bookkeeping' record.id %}" class="action-icon edit" title="Edit">
                                  <i class="bi bi-pencil-square"></i>
                                </a>
                                <form method="post" action="{% url 'employee_accounts_delete' 'bookkeeping' record.id %}" class="d-inline">
                                  {% csrf_token %}
                                  <button type="submit" class="action-icon delete" title="Delete" onclick="return confirm('Delete this bookkeeping record?');">
                                    <i class="bi bi-trash"></i>
                                  </button>
                                </form>
                              </td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                      {% else %}
                      <p class="text-muted small mb-0">No bookkeeping records saved yet.</p>
                      {% endif %}
                    </div>
                  </div>
                </div>

                <div class="col-lg-4">
                  <div class="card border-0 shadow-sm accounts-section-card">
                    <div class="card-header bg-transparent">
                      <h6 class="mb-0 text-primary">Process Streams</h6>
                    </div>
                    <div class="card-body">
                      {% for stream in bookkeeping_streams %}
                      <div class="mb-3 pb-3 border-bottom">
                        <h6 class="fw-semibold">{{ stream.title }}</h6>
                        <ul class="list-unstyled small text-muted mb-0">
                          {% for input in stream.inputs %}
                          <li class="mb-1"><i class="bi bi-check2 text-success me-2"></i>{{ input }}</li>
                          {% endfor %}
                        </ul>
                      </div>
                      {% empty %}
                      <p class="text-muted">No bookkeeping streams defined.</p>
                      {% endfor %}
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- TDS Tab -->
            <div class="tab-pane fade" id="tds-pane" role="tabpanel" aria-labelledby="tds-tab">
              <div class="row g-4">
                <div class="col-xl-8">
                  <div class="card border-0 shadow-sm accounts-section-card">
                    <div class="card-header bg-transparent">
                      <h6 class="mb-0 text-primary">TDS Payment & Return Tracker</h6>
                    </div>
                    <div class="card-body">
                      <form method="post" enctype="multipart/form-data" class="row g-3">
                        {% csrf_token %}
                        <input type="hidden" name="form_name" value="tds">
                        {% if tds_form.non_field_errors %}
                        <div class="col-12">
                          <div class="alert alert-danger mb-0">
                            {{ tds_form.non_field_errors }}
                          </div>
                        </div>
                        {% endif %}
                        <div class="col-md-4">
                          <label class="form-label">Deductor TAN</label>
                          {{ tds_form.deductor_tan }}
                          {% if tds_form.deductor_tan.errors %}
                          <div class="text-danger small">{{ tds_form.deductor_tan.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-4">
                          <label class="form-label">Section</label>
                          {{ tds_form.section }}
                          {% if tds_form.section.errors %}
                          <div class="text-danger small">{{ tds_form.section.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-4">
                          <label class="form-label">Deduction Month</label>
                          {{ tds_form.deduction_month }}
                          {% if tds_form.deduction_month.errors %}
                          <div class="text-danger small">{{ tds_form.deduction_month.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Total Payment Amount (₹)</label>
                          {{ tds_form.total_payment_amount }}
                          {% if tds_form.total_payment_amount.errors %}
                          <div class="text-danger small">{{ tds_form.total_payment_amount.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">TDS Deducted (₹)</label>
                          {{ tds_form.tds_deducted }}
                          {% if tds_form.tds_deducted.errors %}
                          <div class="text-danger small">{{ tds_form.tds_deducted.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Challan Number (CIN)</label>
                          {{ tds_form.challan_number }}
                          {% if tds_form.challan_number.errors %}
                          <div class="text-danger small">{{ tds_form.challan_number.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Challan Date</label>
                          {{ tds_form.challan_date }}
                          {% if tds_form.challan_date.errors %}
                          <div class="text-danger small">{{ tds_form.challan_date.errors|join:", " }}</div>
                          {% endif %}
                        </div>
                        <div class="col-12">
                          <label class="form-label">Upload Proofs</label>
                          <div class="upload-dropzone">
                            <i class="bi bi-cloud-arrow-up fs-3 text-primary"></i>
                            <p class="mb-1 fw-semibold">Upload challan, deduction worksheet, payee confirmation</p>
                            <input type="file" class="form-control" name="tds_proofs" multiple>
                          </div>
                        </div>
                        <div class="col-12 d-flex justify-content-end gap-2">
                          <button type="submit" name="action" value="save" class="btn btn-outline-secondary">Save Record</button>
                          <button type="submit" name="action" value="prepare" class="btn btn-primary">Prepare 26Q/24Q</button>
                        </div>
                      </form>
                      <div class="section-divider"></div>
                      <h6 class="text-muted text-uppercase small mb-3">Saved Records</h6>
                      {% if tds_records %}
                      <div class="table-wrapper table-section">
                        <table class="table table-hover align-middle mb-0 accounts-table">
                          <thead>
                            <tr>
                              <th>Deductor TAN</th>
                              <th>Section</th>
                              <th>Deduction Month</th>
                              <th>TDS Deducted (₹)</th>
                              <th>Challan Number</th>
                              <th>Created</th>
                              <th class="text-end">Actions</th>
                            </tr>
                          </thead>
                          <tbody>
                            {% for record in tds_records %}
                            <tr>
                              <td class="fw-semibold">{{ record.deductor_tan }}</td>
                              <td>{{ record.section }}</td>
                              <td>{{ record.deduction_month }}</td>
                              <td>{{ record.tds_deducted|floatformat:2 }}</td>
                              <td>{{ record.challan_number }}</td>
                              <td class="text-muted small">{{ record.created_at|date:"d M Y" }}</td>
                              <td class="actions-column text-end">
                                <a href="{% url 'employee_accounts_edit' 'tds' record.id %}" class="action-icon edit" title="Edit">
                                  <i class="bi bi-pencil-square"></i>
                                </a>
                                <form method="post" action="{% url 'employee_accounts_delete' 'tds' record.id %}" class="d-inline">
                                  {% csrf_token %}
                                  <button type="submit" class="action-icon delete" title="Delete" onclick="return confirm('Delete this TDS record?');">
                                    <i class="bi bi-trash"></i>
                                  </button>
                                </form>
                              </td>
                            </tr>
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>
                      {% else %}
                      <p class="text-muted small mb-0">No TDS compliance records saved yet.</p>
                      {% endif %}
                    </div>
                  </div>
                </div>

                <div class="col-xl-4">
                  <div class="card border-0 shadow-sm mb-3 accounts-section-card">
                    <div class="card-header bg-transparent">
                      <h6 class="mb-0 text-primary">TDS Sections Overview</h6>
                    </div>
                    <div class="card-body">
                      {% for category in tds_categories %}
                      <div class="mb-3 pb-3 border-bottom">
                        <h6 class="fw-semibold">{{ category.section }}</h6>
                        <p class="mb-1 small text-muted">Threshold: {{ category.threshold }}</p>
                        <p class="mb-1 small text-muted">Due date: {{ category.due_date }}</p>
                        <span class="badge bg-light text-primary fw-semibold">Docs: {{ category.documents }}</span>
                      </div>
                      {% empty %}
                      <p class="text-muted">No TDS categories configured.</p>
                      {% endfor %}
                    </div>
                  </div>

                  <div class="card border-0 shadow-sm accounts-section-card">
                    <div class="card-header bg-transparent">
                      <h6 class="mb-0 text-primary">Quick Checks</h6>
                    </div>
                    <div class="card-body small text-muted">
                      <ul class="list-unstyled mb-0">
                        <li class="mb-2"><i class="bi bi-dot text-primary fs-4 align-middle"></i>Validate PAN and 15G/15H declarations before reduced deduction.</li>
                        <li class="mb-2"><i class="bi bi-dot text-primary fs-4 align-middle"></i>Verify challan status on OLTAS before return submission.</li>
                        <li><i class="bi bi-dot text-primary fs-4 align-middle"></i>Capture late filing fees and interest computation, if applicable.</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock %}

