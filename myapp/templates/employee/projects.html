{% extends "employee/base.html" %}
{% load static %}

{% block title %}My Projects - Sujata Associates{% endblock %}
{% block page_title %}My Projects{% endblock %}
{% block mobile_title %}Projects{% endblock %}

{% block content %}
<!-- Project Stats -->
<div class="row mb-4">
  <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 mb-3">
    <div class="metric-card">
      <div class="d-flex align-items-center">
        <div class="metric-icon primary">
          <i class="bi bi-kanban"></i>
        </div>
        <div>
          <div class="metric-title">Total Projects</div>
          <div class="metric-value">{{ total_projects }}</div>
          <div class="metric-subtitle">All time</div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 mb-3">
    <div class="metric-card">
      <div class="d-flex align-items-center">
        <div class="metric-icon success">
          <i class="bi bi-check-circle"></i>
        </div>
        <div>
          <div class="metric-title">Completed</div>
          <div class="metric-value">{{ completed_projects }}</div>
          <div class="metric-subtitle">This year</div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 mb-3">
    <div class="metric-card">
      <div class="d-flex align-items-center">
        <div class="metric-icon warning">
          <i class="bi bi-clock"></i>
        </div>
        <div>
          <div class="metric-title">In Progress</div>
          <div class="metric-value">{{ in_progress_projects }}</div>
          <div class="metric-subtitle">Active now</div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 mb-3">
    <div class="metric-card">
      <div class="d-flex align-items-center">
        <div class="metric-icon info">
          <i class="bi bi-calendar-event"></i>
        </div>
        <div>
          <div class="metric-title">Due This Week</div>
          <div class="metric-value">{{ due_this_week }}</div>
          <div class="metric-subtitle">Deadlines</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Project Filters -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <div class="row align-items-center">
          <div class="col-md-6">
            <h5 class="mb-0">Project Management</h5>
            <p class="text-muted mb-0">Manage and track your assigned projects</p>
          </div>
          <div class="col-md-6">
            <div class="d-flex gap-2 justify-content-md-end">
              <div class="btn-group" role="group">
                <input type="radio" class="btn-check" name="viewMode" id="gridView" checked>
                <label class="btn btn-outline-primary" for="gridView">
                  <i class="bi bi-grid-3x3"></i>
                </label>
                <input type="radio" class="btn-check" name="viewMode" id="listView">
                <label class="btn btn-outline-primary" for="listView">
                  <i class="bi bi-list"></i>
                </label>
              </div>
              <select class="form-select" style="width: auto;">
                <option>All Projects</option>
                <option>In Progress</option>
                <option>Completed</option>
                <option>On Hold</option>
              </select>
              <a href="{% url 'employee_new_project' %}" class="btn btn-primary">
                <i class="bi bi-plus"></i> New Project
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Projects Grid View -->
<div class="row" id="projectsGrid">
  {% if projects %}
    {% for project in projects %}
      <div class="col-xl-4 col-lg-6 col-md-6 col-sm-12 mb-4">
        <div class="card h-100 project-card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <div class="d-flex align-items-center">
              {% if project.type == "Web Application" %}
                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                  <i class="bi bi-code-slash"></i>
                </div>
              {% elif project.type == "Mobile Application" %}
                <div class="bg-warning text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                  <i class="bi bi-mobile"></i>
                </div>
              {% elif project.type == "Backend Task" %}
                <div class="bg-info text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                  <i class="bi bi-database"></i>
                </div>
              {% elif project.type == "Security Task" %}
                <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                  <i class="bi bi-shield-check"></i>
                </div>
              {% elif project.type == "Data Visualization" %}
                <div class="bg-danger text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                  <i class="bi bi-graph-up"></i>
                </div>
              {% elif project.type == "Infrastructure" %}
                <div class="bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                  <i class="bi bi-cloud"></i>
                </div>
              {% else %}
                <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                  <i class="bi bi-kanban"></i>
                </div>
              {% endif %}
              <div>
                <h6 class="mb-0">{{ project.name }}</h6>
                <small class="text-muted">{{ project.type }}</small>
              </div>
            </div>
            <div class="dropdown">
              <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                <i class="bi bi-three-dots-vertical"></i>
              </button>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="{% url 'employee_project_detail' project_id=project.id %}"><i class="bi bi-eye me-2"></i>View Details</a></li>
                <li><a class="dropdown-item" href="#"><i class="bi bi-pencil me-2"></i>Edit</a></li>
                <li><a class="dropdown-item" href="#"><i class="bi bi-download me-2"></i>Export</a></li>
                <li><hr class="dropdown-divider"></li>
                <li><a class="dropdown-item text-danger" href="#"><i class="bi bi-trash me-2"></i>Delete</a></li>
              </ul>
            </div>
          </div>
          <div class="card-body">
            <p class="text-muted small mb-3">{{ project.description|truncatewords:20 }}</p>
            
            <div class="mb-3">
              <div class="d-flex justify-content-between align-items-center mb-1">
                <span class="small fw-bold">Progress</span>
                <span class="small text-muted">{{ project.progress }}%</span>
              </div>
              <div class="progress" style="height: 8px;">
                {% if project.progress >= 80 %}
                  <div class="progress-bar bg-success" style="width: {{ project.progress }}%"></div>
                {% elif project.progress >= 50 %}
                  <div class="progress-bar bg-info" style="width: {{ project.progress }}%"></div>
                {% elif project.progress >= 30 %}
                  <div class="progress-bar bg-warning" style="width: {{ project.progress }}%"></div>
                {% else %}
                  <div class="progress-bar bg-danger" style="width: {{ project.progress }}%"></div>
                {% endif %}
              </div>
            </div>
            
            <div class="row text-center mb-3">
              <div class="col-4">
                <div class="fw-bold text-primary">{{ project.tasks_total }}</div>
                <div class="small text-muted">Tasks</div>
              </div>
              <div class="col-4">
                <div class="fw-bold text-success">{{ project.tasks_completed }}</div>
                <div class="small text-muted">Completed</div>
              </div>
              <div class="col-4">
                <div class="fw-bold text-warning">{{ project.tasks_pending }}</div>
                <div class="small text-muted">Pending</div>
              </div>
            </div>
            
            <div class="d-flex justify-content-between align-items-center">
              <div>
                {% if project.status == "Completed" %}
                  <div class="small text-muted">Completed</div>
                {% else %}
                  <div class="small text-muted">Due Date</div>
                {% endif %}
                {% if project.due_date %}
                  <div class="fw-bold">{{ project.due_date }}</div>
                {% else %}
                  <div class="fw-bold">N/A</div>
                {% endif %}
              </div>
              {% if project.status == "In Progress" %}
                <span class="status-badge status-active">{{ project.status }}</span>
              {% elif project.status == "Pending" %}
                <span class="status-badge status-pending">{{ project.status }}</span>
              {% elif project.status == "On Hold" %}
                <span class="status-badge status-pending">{{ project.status }}</span>
              {% elif project.status == "Completed" %}
                <span class="status-badge status-completed">{{ project.status }}</span>
              {% else %}
                <span class="status-badge status-pending">{{ project.status }}</span>
              {% endif %}
            </div>
          </div>
          <div class="card-footer bg-transparent">
            <div class="d-flex justify-content-between">
              <a href="{% url 'employee_project_detail' project_id=project.id %}" class="btn btn-sm btn-outline-primary">
                <i class="bi bi-eye me-1"></i>View Details
              </a>
              {% if project.status == "Completed" %}
                <a href="{% url 'employee_project_detail' project_id=project.id %}" class="btn btn-sm btn-outline-success">
                  <i class="bi bi-download me-1"></i>Report
                </a>
              {% elif project.status == "In Progress" %}
                <a href="{% url 'employee_continue_project' project_id=project.id %}" class="btn btn-sm btn-primary">
                  <i class="bi bi-play me-1"></i>Continue
                </a>
              {% elif project.status == "On Hold" %}
                <a href="{% url 'employee_start_project' project_id=project.id %}" class="btn btn-sm btn-outline-warning">
                  <i class="bi bi-play me-1"></i>Resume
                </a>
              {% else %}
                <a href="{% url 'employee_start_project' project_id=project.id %}" class="btn btn-sm btn-warning">
                  <i class="bi bi-play me-1"></i>Start
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <div class="col-12">
      <div class="alert alert-info text-center">
        <i class="bi bi-info-circle me-2"></i>No projects assigned to you yet.
      </div>
    </div>
  {% endif %}
</div>

<!-- Projects List View (Hidden by default) -->
<div class="row d-none" id="projectsList">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Project</th>
                <th>Progress</th>
                <th>Tasks</th>
                <th>Due Date</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% if projects %}
                {% for project in projects %}
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        {% if project.type == "Web Application" %}
                          <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                            <i class="bi bi-code-slash"></i>
                          </div>
                        {% elif project.type == "Mobile Application" %}
                          <div class="bg-warning text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                            <i class="bi bi-mobile"></i>
                          </div>
                        {% elif project.type == "Backend Task" %}
                          <div class="bg-info text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                            <i class="bi bi-database"></i>
                          </div>
                        {% elif project.type == "Security Task" %}
                          <div class="bg-success text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                            <i class="bi bi-shield-check"></i>
                          </div>
                        {% elif project.type == "Data Visualization" %}
                          <div class="bg-danger text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                            <i class="bi bi-graph-up"></i>
                          </div>
                        {% elif project.type == "Infrastructure" %}
                          <div class="bg-secondary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                            <i class="bi bi-cloud"></i>
                          </div>
                        {% else %}
                          <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
                            <i class="bi bi-kanban"></i>
                          </div>
                        {% endif %}
                        <div>
                          <div class="fw-bold">{{ project.name }}</div>
                          <small class="text-muted">{{ project.type }}</small>
                        </div>
                      </div>
                    </td>
                    <td>
                      <div class="progress" style="height: 8px; width: 100px;">
                        {% if project.progress >= 80 %}
                          <div class="progress-bar bg-success" style="width: {{ project.progress }}%"></div>
                        {% elif project.progress >= 50 %}
                          <div class="progress-bar bg-info" style="width: {{ project.progress }}%"></div>
                        {% elif project.progress >= 30 %}
                          <div class="progress-bar bg-warning" style="width: {{ project.progress }}%"></div>
                        {% else %}
                          <div class="progress-bar bg-danger" style="width: {{ project.progress }}%"></div>
                        {% endif %}
                      </div>
                      <small class="text-muted">{{ project.progress }}%</small>
                    </td>
                    <td>
                      <span class="badge bg-primary">{{ project.tasks_total }}</span>
                      <small class="text-muted ms-1">({{ project.tasks_completed }} completed)</small>
                    </td>
                    <td>{{ project.due_date|default:"N/A" }}</td>
                    <td>
                      {% if project.status == "In Progress" %}
                        <span class="status-badge status-active">{{ project.status }}</span>
                      {% elif project.status == "Pending" %}
                        <span class="status-badge status-pending">{{ project.status }}</span>
                      {% elif project.status == "On Hold" %}
                        <span class="status-badge status-pending">{{ project.status }}</span>
                      {% elif project.status == "Completed" %}
                        <span class="status-badge status-completed">{{ project.status }}</span>
                      {% else %}
                        <span class="status-badge status-pending">{{ project.status }}</span>
                      {% endif %}
                    </td>
                    <td>
                      <div class="btn-group btn-group-sm">
                        <a href="{% url 'employee_project_detail' project_id=project.id %}" class="btn btn-outline-primary">View</a>
                        {% if project.status == "Completed" %}
                          <a href="{% url 'employee_project_detail' project_id=project.id %}" class="btn btn-success">Report</a>
                        {% elif project.status == "In Progress" %}
                          <a href="{% url 'employee_continue_project' project_id=project.id %}" class="btn btn-primary">Continue</a>
                        {% elif project.status == "On Hold" %}
                          <a href="{% url 'employee_start_project' project_id=project.id %}" class="btn btn-warning">Resume</a>
                        {% else %}
                          <a href="{% url 'employee_start_project' project_id=project.id %}" class="btn btn-warning">Start</a>
                        {% endif %}
                      </div>
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="6" class="text-center">
                    <div class="alert alert-info mb-0">
                      <i class="bi bi-info-circle me-2"></i>No projects assigned to you yet.
                    </div>
                  </td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  .project-card {
    transition: all 0.3s ease;
    border: 1px solid #e9ecef;
  }
  
  .project-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
  }
  
  .project-card .card-header {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border-bottom: 1px solid #dee2e6;
  }
  
  .project-card .card-footer {
    border-top: 1px solid #e9ecef;
    background: #f8f9fa;
  }
  
  /* Make project headings black */
  .project-card .card-header h6 {
    color: #000000 !important;
  }
  
  /* Also make headings black in list view */
  .table .fw-bold {
    color: #000000 !important;
  }
</style>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // View mode toggle
    const gridView = document.getElementById('gridView');
    const listView = document.getElementById('listView');
    const projectsGrid = document.getElementById('projectsGrid');
    const projectsList = document.getElementById('projectsList');
    
    gridView.addEventListener('change', function() {
      if (this.checked) {
        projectsGrid.classList.remove('d-none');
        projectsList.classList.add('d-none');
      }
    });
    
    listView.addEventListener('change', function() {
      if (this.checked) {
        projectsGrid.classList.add('d-none');
        projectsList.classList.remove('d-none');
      }
    });
  });
</script>
{% endblock %}
